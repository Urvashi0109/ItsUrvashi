---
const { headings, maxLevel = 3 } = Astro.props;
const toc = buildToc(headings);
function buildToc(headings: any) {
	const _toc: any = [];
	const parentHeadings = new Map();
	(headings || []).forEach((h: any) => {
		const heading = { ...h, subheadings: [] };
		parentHeadings.set(heading.depth, heading);
		// Change 2 to 1 if your markdown includes your <h1>
		if (heading.depth === 2) {
			_toc.push(heading);
		} else {
			if (maxLevel > 2) {
				parentHeadings.get(heading.depth - 1)?.subheadings?.push(heading);
			}
		}
	});
	return _toc;
}
---

<nav class='toc sticky top-4 py-3 lg:-ml-3 rounded-xl border border-zinc-200 dark:border-zinc-700/50 bg-zinc-50/50 dark:bg-zinc-800/30'>
	<h3 class='font-extrabold uppercase mb-2 px-4 text-xs tracking-wider text-zinc-500 dark:text-zinc-400'>ðŸ“‘ On This Page</h3>
	<ul class='toc-list max-h-[calc(100vh-70px)] overflow-auto text-[.8rem]'>
		{
			toc.map((heading: any, index: number) => (
				<li>
					<a
						class='toc-link block font-semibold py-2 px-4 border-l-2 border-transparent leading-tight text-zinc-600 dark:text-zinc-400 transition-all duration-200 hover:text-primary hover:underline hover:decoration-primary/50 hover:underline-offset-2 hover:border-l-primary hover:bg-primary/5'
						href={'#' + heading.slug}>
						<span class='text-zinc-400 dark:text-zinc-500 mr-1.5 text-xs font-mono'>{String(index + 1).padStart(2, '0')}</span>
						{heading.text}
					</a>
					{heading.subheadings?.length > 0 && (
						<ul>
							{heading.subheadings.map((subheading: any) => (
								<li>
									<a
										class='toc-link block py-1.5 pl-9 pr-4 border-l-2 border-transparent leading-tight text-zinc-500 dark:text-zinc-500 text-[.75rem] transition-all duration-200 hover:text-primary hover:underline hover:decoration-primary/50 hover:underline-offset-2 hover:border-l-primary/50 hover:bg-primary/5'
										href={'#' + subheading.slug}>
										{subheading.text}
									</a>
								</li>
							))}
						</ul>
					)}
				</li>
			))
		}
	</ul>
</nav>
<style>
	.toc-list::-webkit-scrollbar {
		width: 5px;
	}

	/* Track */
	.toc-list::-webkit-scrollbar-track {
		background: transparent;
	}

	/* Handle */
	.toc-list::-webkit-scrollbar-thumb {
		background: #eeeeee;
		border-radius: 5px;
	}
  :global(.dark) .toc-list::-webkit-scrollbar-thumb {
		background: #2e2e2e;
		border-radius: 5px;
	}
</style>
